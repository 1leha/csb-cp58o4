(this["webpackJsonpgoit-textbook-lesson-15-16-auth-final"]=this["webpackJsonpgoit-textbook-lesson-15-16-auth-final"]||[]).push([[1],{115:function(e,t,n){},116:function(e,t,n){"use strict";n.r(t);var r,a,c=n(0),s=n.n(c),u=n(57),i=n.n(u),o=n(16),l=n(2),b=n(60),j=n(14),d=function(e){return e.auth.isLoggedIn},f=function(e){return e.auth.user},p=function(e){return e.auth.isRefreshing},O=function(){return{isLoggedIn:Object(o.c)(d),isRefreshing:Object(o.c)(p),user:Object(o.c)(f)}},h=n(42),g=n.n(h),x=n(3),m=function(){var e=O().isLoggedIn;return Object(x.jsxs)("nav",{children:[Object(x.jsx)(j.b,{className:g.a.link,to:"/",children:"Home"}),e&&Object(x.jsx)(j.b,{className:g.a.link,to:"/tasks",children:"Tasks"})]})},v=n(13),k=n(44),y=n.n(k),w=function(){var e=Object(o.b)(),t=O().user;return Object(x.jsxs)("div",{className:y.a.wrapper,children:[Object(x.jsxs)("p",{className:y.a.username,children:["Welcome, ",t.name]}),Object(x.jsx)("button",{type:"button",onClick:function(){return e(Object(v.b)())},children:"Logout"})]})},L=n(45),_=n.n(L),I=function(){return Object(x.jsxs)("div",{children:[Object(x.jsx)(j.b,{className:_.a.link,to:"/register",children:"Register"}),Object(x.jsx)(j.b,{className:_.a.link,to:"/login",children:"Log In"})]})},R=n(61),N=n.n(R),W=function(){var e=O().isLoggedIn;return Object(x.jsxs)("header",{className:N.a.header,children:[Object(x.jsx)(m,{}),e?Object(x.jsx)(w,{}):Object(x.jsx)(I,{})]})},T=function(){return Object(x.jsxs)("div",{style:{maxWidth:960,margin:"0 auto",padding:"0 16px"},children:[Object(x.jsx)(W,{}),Object(x.jsx)(c.Suspense,{fallback:null,children:Object(x.jsx)(l.b,{})}),Object(x.jsx)(b.Toaster,{position:"top-right",reverseOrder:!1})]})},z=function(e){var t=e.component,n=e.redirectTo,r=void 0===n?"/":n,a=O(),c=a.isLoggedIn,s=a.isRefreshing;return!c&&!s?Object(x.jsx)(l.a,{to:r}):t},V=function(e){var t=e.component,n=e.redirectTo,r=void 0===n?"/":n;return O().isLoggedIn?Object(x.jsx)(l.a,{to:r}):t},A=Object(c.lazy)((function(){return n.e(7).then(n.bind(null,129))})),S=Object(c.lazy)((function(){return Promise.all([n.e(0),n.e(6)]).then(n.bind(null,131))})),M=Object(c.lazy)((function(){return Promise.all([n.e(0),n.e(5)]).then(n.bind(null,132))})),U=Object(c.lazy)((function(){return Promise.all([n.e(0),n.e(4)]).then(n.bind(null,130))})),B=function(){var e=Object(o.b)(),t=O().isRefreshing;return Object(c.useEffect)((function(){e(Object(v.c)())}),[e]),t?Object(x.jsx)("b",{children:"Refreshing user..."}):Object(x.jsx)(l.e,{children:Object(x.jsxs)(l.c,{path:"/",element:Object(x.jsx)(T,{}),children:[Object(x.jsx)(l.c,{index:!0,element:Object(x.jsx)(A,{})}),Object(x.jsx)(l.c,{path:"/register",element:Object(x.jsx)(V,{redirectTo:"/tasks",component:Object(x.jsx)(S,{})})}),Object(x.jsx)(l.c,{path:"/login",element:Object(x.jsx)(V,{redirectTo:"/tasks",component:Object(x.jsx)(M,{})})}),Object(x.jsx)(l.c,{path:"/tasks",element:Object(x.jsx)(z,{redirectTo:"/login",component:Object(x.jsx)(U,{})})})]})})},P=n(62),C=n(11),E=n(10),J=n(19),K=n(63),H=n.n(K),Q=n(5),X=n(17),Y=function(e){e.isLoading=!0},q=function(e,t){e.isLoading=!1,e.error=t.payload},D=Object(E.c)({name:"tasks",initialState:{items:[],isLoading:!1,error:null},extraReducers:(r={},Object(Q.a)(r,X.c.pending,Y),Object(Q.a)(r,X.a.pending,Y),Object(Q.a)(r,X.b.pending,Y),Object(Q.a)(r,X.c.rejected,q),Object(Q.a)(r,X.a.rejected,q),Object(Q.a)(r,X.b.rejected,q),Object(Q.a)(r,X.c.fulfilled,(function(e,t){e.isLoading=!1,e.error=null,e.items=t.payload})),Object(Q.a)(r,X.a.fulfilled,(function(e,t){e.isLoading=!1,e.error=null,e.items.push(t.payload)})),Object(Q.a)(r,X.b.fulfilled,(function(e,t){e.isLoading=!1,e.error=null;var n=e.items.findIndex((function(e){return e.id===t.payload.id}));e.items.splice(n,1)})),Object(Q.a)(r,v.b.fulfilled,(function(e){e.items=[],e.error=null,e.isLoading=!1})),r)}).reducer,F=Object(E.c)({name:"auth",initialState:{user:{name:null,email:null},token:null,isLoggedIn:!1,isRefreshing:!1},extraReducers:(a={},Object(Q.a)(a,v.d.fulfilled,(function(e,t){e.user=t.payload.user,e.token=t.payload.token,e.isLoggedIn=!0})),Object(Q.a)(a,v.a.fulfilled,(function(e,t){e.user=t.payload.user,e.token=t.payload.token,e.isLoggedIn=!0})),Object(Q.a)(a,v.b.fulfilled,(function(e){e.user={name:null,email:null},e.token=null,e.isLoggedIn=!1})),Object(Q.a)(a,v.c.pending,(function(e){e.isRefreshing=!0})),Object(Q.a)(a,v.c.fulfilled,(function(e,t){e.user=t.payload,e.isLoggedIn=!0,e.isRefreshing=!1})),Object(Q.a)(a,v.c.rejected,(function(e){e.isRefreshing=!1})),a)}).reducer,G=Object(C.a)(Object(E.d)({serializableCheck:{ignoredActions:[J.a,J.f,J.b,J.c,J.d,J.e]}})),Z={key:"auth",storage:H.a,whitelist:["token"]},$=Object(E.a)({reducer:{auth:Object(J.g)(Z,F),tasks:D},middleware:G,devTools:!1}),ee=Object(J.h)($);n(114),n(115);i.a.createRoot(document.getElementById("root")).render(Object(x.jsx)(s.a.StrictMode,{children:Object(x.jsx)(o.a,{store:$,children:Object(x.jsx)(P.a,{loading:null,persistor:ee,children:Object(x.jsx)(j.a,{children:Object(x.jsx)(B,{})})})})}))},13:function(e,t,n){"use strict";n.d(t,"d",(function(){return o})),n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return b})),n.d(t,"c",(function(){return j}));var r=n(4),a=n(7),c=n(15),s=n.n(c),u=n(10);s.a.defaults.baseURL="https://goit-task-manager.herokuapp.com/";var i=function(e){s.a.defaults.headers.common.Authorization="Bearer ".concat(e)},o=Object(u.b)("auth/register",function(){var e=Object(a.a)(Object(r.a)().mark((function e(t,n){var a;return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.a.post("/users/signup",t);case 3:return a=e.sent,i(a.data.token),e.abrupt("return",a.data);case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.rejectWithValue(e.t0.message));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}()),l=Object(u.b)("auth/login",function(){var e=Object(a.a)(Object(r.a)().mark((function e(t,n){var a;return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.a.post("/users/login",t);case 3:return a=e.sent,i(a.data.token),e.abrupt("return",a.data);case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",n.rejectWithValue(e.t0.message));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}()),b=Object(u.b)("auth/logout",function(){var e=Object(a.a)(Object(r.a)().mark((function e(t,n){return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.a.post("/users/logout");case 3:s.a.defaults.headers.common.Authorization="",e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",n.rejectWithValue(e.t0.message));case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t,n){return e.apply(this,arguments)}}()),j=Object(u.b)("auth/refresh",function(){var e=Object(a.a)(Object(r.a)().mark((function e(t,n){var a,c,u;return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.getState(),null!==(c=a.auth.token)){e.next=4;break}return e.abrupt("return",n.rejectWithValue("Unable to fetch user"));case 4:return e.prev=4,i(c),e.next=8,s.a.get("/users/me");case 8:return u=e.sent,e.abrupt("return",u.data);case 12:return e.prev=12,e.t0=e.catch(4),e.abrupt("return",n.rejectWithValue(e.t0.message));case 15:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t,n){return e.apply(this,arguments)}}())},17:function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return l}));var r=n(4),a=n(7),c=n(10),s=n(15),u=n.n(s),i=Object(c.b)("tasks/fetchAll",function(){var e=Object(a.a)(Object(r.a)().mark((function e(t,n){var a;return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.a.get("/tasks");case 3:return a=e.sent,e.abrupt("return",a.data);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.rejectWithValue(e.t0.message));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}()),o=Object(c.b)("tasks/addTask",function(){var e=Object(a.a)(Object(r.a)().mark((function e(t,n){var a;return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.a.post("/tasks",{text:t});case 3:return a=e.sent,e.abrupt("return",a.data);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.rejectWithValue(e.t0.message));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}()),l=Object(c.b)("tasks/deleteTask",function(){var e=Object(a.a)(Object(r.a)().mark((function e(t,n){var a;return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.a.delete("/tasks/".concat(t));case 3:return a=e.sent,e.abrupt("return",a.data);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",n.rejectWithValue(e.t0.message));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}())},42:function(e,t,n){e.exports={link:"Navigation_link__12o2K",active:"Navigation_active__1Sofg"}},44:function(e,t,n){e.exports={wrapper:"UserMenu_wrapper__3KSXQ",username:"UserMenu_username__2nvIz"}},45:function(e,t,n){e.exports={link:"AuthNav_link__2ejsg",active:"AuthNav_active__2WI0M"}},61:function(e,t,n){e.exports={header:"AppBar_header__1Yk8v"}}},[[116,2,3]]]);
//# sourceMappingURL=main.9719eb2f.chunk.js.map